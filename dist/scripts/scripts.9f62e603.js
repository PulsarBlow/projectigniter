!function(a){"use strict";a.module("app",["ngAnimate","app.config","app.routes","app.controllers","app.directives","app.decorators","app.filters","app.services","ui.sortable","ui.bootstrap","timer"])}(window.angular||{}),function(a){"use strict";a.module("app.config",["ui.bootstrap"]).value("FBURL","https://projectigniter-demo.firebaseio.com").constant("MAX_FAVORITES",5).constant("ANONYMOUS_ID","local:anonymous").constant("LOCAL_PROVIDER","local").constant("loginRedirectPath","/signin").constant("ACTIVITY_LIMIT",50).config(["$compileProvider","$logProvider",function(a,b){a.debugInfoEnabled(!1),b.debugEnabled(!1)}]).config(["$tooltipProvider",function(a){a.options({appendToBody:!0,popupDelay:250})}]).run(["$log","$rootScope","$window","activityService",function(a,b,c,d){a.debug("Running app"),c.moment.locale("fr"),b.$on("activity:trigger",function(b,c){a.debug("activity event received : %s",c.name),d.exist(c.name)})}])}(window.angular||{}),function(a){"use strict";a.module("app.routes",["ngRoute","ui.router","simpleLogin"]).config(["$locationProvider",function(a){a.html5Mode(!0).hashPrefix("!")}]).config(["$stateProvider","$urlRouterProvider",function(b,c){c.when("","/"),c.otherwise("/404"),c.rule(function(a,b){var c=b.path(),d=c.toLowerCase();c!==d&&b.replace().path(d)}),b.state("signin",{url:"/signin",templateUrl:"views/signin.html",controller:"SigninController",resolve:{userLoginInfo:["$log","$q","$rootScope","simpleLogin",function(a,b,c,d){return d.getUser()}]}}).state("404",{url:"/404",templateUrl:"views/404.html"}).state("app",{"abstract":!0,url:"",data:{authRequired:!0},templateUrl:"views/index.html",controller:"AppController",resolve:{dataSync:["$q","simpleLogin","userService",function(b,c,d){var e,f,g,h=b.defer();return c.getUser().then(function(c){return a.isObject(c)&&c.uid?(e=d.syncUser(c.uid),f=d.syncUserProfile(c.uid),g=d.syncUserConfig(c.uid),void b.all([d.tryCreateUser(c),d.tryCreateUserProfile(c),d.tryCreateUserConfig(c),e.$loaded(),f.$loaded()]).then(function(){h.resolve({user:e,userProfile:f,userConfig:g})})):void h.reject()}),h.promise}]}}).state("app.home",{url:"/",templateUrl:"views/pages/home.html",controller:"HomeController"}).state("app.concept",{url:"/concept",templateUrl:"views/pages/concept.html"}).state("app.votes",{url:"/votes",templateUrl:"views/pages/votes.html",controller:"VotesController"}).state("app.vote",{"abstract":!0,url:"/vote/:id",templateUrl:"views/pages/vote.html",controller:"VoteController",resolve:{vote:["$q","$location","$stateParams","voteService",function(a,b,c,d){var e=a.defer();return d.sync.vote(c.id).$loaded(function(a){a.id?e.resolve(a):(b.replace(),b.path("/404"),e.reject())}),e.promise}],userVote:["$q","$stateParams","voteService","dataSync",function(a,b,c,d){var e=a.defer();return c.sync.userVote(d.user.id,b.id).$loaded(function(a){e.resolve(a)}),e.promise}]}}).state("app.vote.default",{url:"",controller:"VoteController",templateUrl:"views/pages/vote/default.html"}).state("app.vote.edit",{url:"/edit",templateUrl:"views/pages/vote/edit.html",controller:"VoteEditController"}).state("app.vote.improve",{url:"/improve",templateUrl:"views/pages/vote/improve.html",controller:"VoteImproveController"})}]).run(["$log","$location","$rootScope","$state","simpleLogin","activityService","loginRedirectPath",function(b,c,d,e,f,g,h){function i(a){return a&&a.data&&a.data.authRequired?!0:!1}function j(a){b.debug("routes:redirect to %s",a),c.replace(),c.path(a)}var k,l=!1,m="/",n=null;b.debug("app.routes:run",{rootScope:d,state:e,loginRedirectPath:h}),d.$on("$stateChangeStart",function(a,c,d,e){b.debug("routes:$stateChangeStart",{fromState:e,fromStateUrl:e.url,toState:c,toStateUrl:c.url,isAuthenticated:l,isAuthRequired:i(c)}),i(c)&&!l&&(b.debug("routes:$stateChangeStart - Need authentication",{isAuthenticated:l,authRequired:i(c)}),j(h))}),d.$on("$firebaseSimpleLogin:login",function(d,f){l=a.isObject(f)&&f.uid?!0:!1,b.debug("$firebaseSimpleLogin:login",{userLoginInfo:f,isAuthenticated:l,currentState:e.current,currentStateUrl:e.current.url,currentStateAuthRequired:i(e.current)}),n?(j(n),n=null):c.path()===h&&j(m)}),d.$on("$firebaseSimpleLogin:logout",function(){b.debug("$firebaseSimpleLogin:logout",{currentState:e.current,currentStateUrl:e.current.url,currentStateAuthRequired:i(e.current)}),l=!1,k=null,j(h)}),d.$on("$firebaseSimpleLogin:error",function(){b.debug("$firebaseSimpleLogin:error",{currentState:e.current,currentStateUrl:e.current.url,currentStateAuthRequired:i(e.current)}),l=!1,j(h)})}])}(window.angular||{}),function(a){"use strict";a.module("app.controllers",["firebase.utils"]).controller("SigninController",["$log","$scope","$location","simpleLogin","userLoginInfo",function(a,b,c,d,e){a.debug("SigninController instantiated",{userLoginInfo:e}),b.signin=function(a){d.login(a)}}]).controller("AppController",["$log","$rootScope","$scope","simpleLogin","dataSync",function(a,b,c,d,e){a.debug("AppController instantiated",{dataSync:e}),e.user.$bindTo(b,"user"),e.userProfile.$bindTo(b,"userProfile"),e.userConfig.$bindTo(b,"userConfig"),b.$on("nav:stateChanged",function(a,b){e.userConfig.navCollapsed=b.collapsed,e.userConfig.$save()}),c.signout=function(){d.logout()}}]).controller("HomeController",["$log","$scope","$state","activityService","voteService","ACTIVITY_LIMIT",function(a,b,c,d,e,f){a.debug("HomeController instantiated");var g=f;b.activities=d.sync(g),b.limit=g,b.votes=e.sync.votes,b.getMoment=function(a,b,c){var d=b?moment(b):moment();return moment(a).from(d,c)},b.getVoteProgress=function(a){return e.getVoteProgress(a)},b.like=function(a){d.like(a,b.user,b.userProfile)},b.isMyActivity=function(a){return a===b.user.id},b.hasLiked=function(a){return a?b.user.id in a:!1},b.goTo=function(a){a&&c.go(a)}}]).controller("VotesController",["$log","$scope","$state","voteService",function(b,c,d,e){function f(a){var b=moment(),c=moment(a.dateStart?a.dateStart:0),d=moment(a.dateEnd?a.dateEnd:"2020-01-01");return b.isAfter(c,"min")&&b.isBefore(d,"min")}b.debug("VotesController instantiated"),c.votes=e.sync.votes,c.getStatus=function(b){var c={value:"locked",label:"A venir"};return a.isObject(b)?(b.isLocked||(f(b)?(c.value="opened",c.label="En cours"):(c.value="closed",c.label="Terminé")),c):c},c.viewDetails=function(a){return a&&a.id?void d.go("app.vote.default",{id:a.id}):void b.warn("Cancelling viewDetails",{vote:a})}}]).controller("VoteController",["$log","$rootScope","$scope","$state","$stateParams","voteService","counterService","notifier",function(a,b,c,d,e,f,g,h){a.debug("VoteController instantiated",{stateParams:e});var i=f.sync.vote(e.id),j=(f.sync.voteResult(e.id),f.createSelection(e.id),g.voteCounters(e.id));j.$bindTo(c,"voteCounters"),i.$bindTo(c,"vote"),c.voteId=e.id,c.voteSummary=f.sync.voteSummary(e.id),c.getPercent=function(a){return 0===c.voteResult.totalPoints?0:Math.round(100*a/c.voteResult.totalPoints)},c.shouldShowTimer=function(a){return a&&a.dateEnd?moment().isBefore(moment(a.dateEnd)):!1},c.optinFeedback=function(){c.userConfig.emailOnVoteEnd?h.success("Vous recevrez le résultat final du vote par email","Inscription enregistrée"):h.info("Vous ne recevrez pas d'email.","Désinscription enregistrée")},c.getMoment=function(a){return moment(a).fromNow()}}]).controller("VoteEditController",["$log","$rootScope","$scope","$state","$stateParams","voteService","counterService","notifier","userVote",function(a,b,c,d,e,f,g,h,i){a.debug("VoteEditController instantiated");var j=f.sync.vote(e.id),k=f.createSelection(e.id);j.$bindTo(c,"vote"),j.$watch(function(){a.debug("syncVote:watch",{syncVote:j,scopeVote:c.vote}),k.changeLimit(j.options.maxItems)},this),c.userVote=i,c.selection=k,c.sortableOptions={opacity:.5,axis:"y"},c.getPoints=function(a){return Math.pow(2,k.limit-a)},c.toggleSelection=function(a){a&&(k.isFull()?k.remove(a):k.addOrRemove(a))},c.saveVote=function(){var a=[];k.forEach(function(b,d){a.push({value:b.value,id:b.id,points:c.getPoints(d)})}),f.saveUserVote(k.voteId,a,c.user,c.userProfile).then(function(){k.clear(),h.success("Merci de votre participation","Vote enregistré!")},function(){h.error("L'enregistrement du vote a échoué. Veuillez réessayer.","Erreur")})},c.deleteVote=function(){f.removeUserVote(e.id,c.user,c.userProfile).then(function(){h.info("Vous pouvez revoter.","Vote supprimé")},function(){h.error("La suppression du vote a échoué. Veuillez réessayer.","Erreur")})}}]).controller("VoteImproveController",["$log","$state","$stateParams","$scope","voteService","nameCheckService","notifier",function(b,c,d,e,f,g,h){b.debug("VoteImproveController instantiated",{stateParams:d}),e.nameChecks={all:[],valid:[],notValid:[]},e.checkInProgress=!1,e.validate=function(a){b.debug("VoteImproveController:validate name:%s",a),e.checkInProgress=!0,g.check(a).then(function(a){b.debug("VoteImproveController:validate result",a),e.nameChecks.all.push(a),a.isValid()?e.nameChecks.valid.push(a):e.nameChecks.notValid.push(a),e.newName=null},function(a){b.debug("VoteImproveController:validate failed",a)}).finally(function(){e.checkInProgress=!1})},e.submit=function(){b.debug("VoteImproveController:submit",e.nameChecks.valid),f.saveVoteSuggestion(e.voteId,e.nameChecks.valid,e.user,e.userProfile).then(function(){h.success("Après revue positive nous les incluerons au vote.","Propositions envoyées"),c.go("app.vote.default")})},e.reset=function(){e.nameChecks.all=[],e.nameChecks.valid=[],e.nameChecks.notValid=[]},e.resetOne=function(b){function c(b,c){if(b&&a.isArray(c)){var d=c.indexOf(b);-1!==d&&c.splice(d,1)}}b&&(c(b,e.nameChecks.all),b.isValid()?c(b,e.nameChecks.valid):c(b,e.nameChecks.notValid))}}])}(window.angular||{}),function(a){"use strict";function b(b){var c={},d=[];return d.add=function(a){return!a||!a.id||a.id in c?!1:(c[a.id]=a,d.push(a),!0)},d.remove=function(a){if(!(a&&a.id&&a.id in c))return!1;delete c[a.id];for(var b;-1!==(b=d.indexOf(a));)d.splice(b,1);return!0},d.contains=function(a){return c[a.id]?!0:!1},d.addOrRemove=function(a){return a?(d.contains(a)?d.remove(a):d.add(a),!0):!1},d.clear=function(){d.splice(0,d.length),c={}},d.changeLimit=function(b){a.isNumber(b)&&b>0&&(d.limit=b)},d.isFull=function(){return d.length>=d.limit},d.changeLimit(b||100),d}a.module("app.services",[]).factory("votes",["$q","fbutil","appCounters","activityService",function(b,c,d,e){function f(b,c,d){if(!(b&&c&&d&&a.isArray(d)))throw new Error("Invalid arguments");d.sort(function(a,b){return b.points-a.points});var e={userInfo:{displayName:b.displayName||"Anonymous",pageUrl:c.pageUrl||null,pictureUrl:c.pictureUrl||null},date:+moment().utc(),voteItems:[]};return d.forEach(function(a){e.voteItems[a.id]=a}),e}var g=function(a){return c.syncObject("userVotes/"+a)};return{syncVotes:function(){return c.syncArray("userVotes")},syncUserVote:g,saveVote:function(b,g,h){if(!(b&&g&&h&&a.isArray(h)))throw new Error("Invalid argument");var i=c.fb("userVotes"),j=f(b,g,h);return i.$set(b.id,j).then(function(){d.addVotesSaved(),e.publish("userVoteSaved",b,g)})},deleteVote:function(a,b){if(!a||!b)throw new Error("Invalid arguments");var f=c.fb("userVotes");return f.$remove(a.id).then(function(){d.addVotesDeleted(),e.publish("userVoteDeleted",a,b)})}}}]).factory("userService",["$log","$FirebaseObject","$firebase","fbutil","activityService","FBURL","ANONYMOUS_ID","LOCAL_PROVIDER",function(b,c,d,e,f,g,h,i){function j(b){if(!a.isObject(b))throw new Error("userLoginInfo is not an object");if(!b.uid)throw new Error("userLoginInfo.uid is not valid")}function k(b){return a.isObject(b)&&b?{id:b.uid||h,provider:b.provider||i,providerId:b.id||h,accessToken:b.accessToken||null,displayName:b.displayName||"Anonymous"}:null}function l(b){return a.isObject(b)&&a.isObject(b.thirdPartyUserData)?m(b.provider,b.thirdPartyUserData):null}function m(b,c){if(!a.isString(b)||!b)throw new Error("Invalid provider");if(!a.isObject(c))throw new Error("Invalid providerUserData");switch(a.lowercase(b)){case"facebook":return n(c);case"google":return o(c);default:throw new Error("Unable to parse user. Provider ["+b+"] is not supported")}}function n(b){function c(b){return a.isObject(b)&&b&&b.data?b.data.url:null}return b?{email:b.email||null,emailVerified:!1,realName:b.name||null,gender:b.gender||null,pageUrl:b.link||null,pictureUrl:c(b.picture),locale:b.locale||"fr_FR"}:{}}function o(a){return a?{email:a.email||null,emailVerified:a.verified_email||!1,realName:a.name||null,gender:a.gender||null,pageUrl:a.link||null,pictureUrl:a.picture||null,locale:a.locale||"fr_FR"}:{}}return{parseUserLoginInfo:function(a){return{user:k(a),userProfile:l(a)}},tryCreateUser:function(b){j(b);var c=e.fb("users/"+b.uid),d=k(b),g=l(b);return c.$transaction(function(a){var c=k(b);return null===a?c:void 0}).then(function(b){if(a.isObject(b))f.publish("usersignedup",d,g);else{var e=c.$asObject();e.$loaded(function(){e.accessToken=d.accessToken,e.displayName=d.displayName,e.$save()})}})},tryCreateUserProfile:function(b){j(b);var c=e.fb("userProfiles/"+b.uid),d=l(b);return c.$transaction(function(a){return null===a?l(b):void 0}).then(function(b){if(a.isObject(b));else{var e=c.$asObject();e.$loaded(function(){e.email=d.email,e.emailVerified=d.emailVerified,e.locale=d.locale,e.pageUrl=d.pageUrl,e.pictureUrl=d.pictureUrl,e.realName=d.realName,e.$save()})}})},tryCreateUserConfig:function(a){j(a);var b=e.fb("userConfigs/"+a.uid);return b.$transaction(function(a){return null===a?{navCollapsed:!1,emailOnVoteEnd:!1}:void 0})},syncUser:function(a){var b=new Firebase(g).child("users").child(a),c=d(b);return c.$asObject()},syncUserProfile:function(a){var b=new Firebase(g).child("userProfiles").child(a),c=d(b);return c.$asObject()},syncUserConfig:function(a){var b=new Firebase(g).child("userConfigs").child(a),c=d(b);return c.$asObject()},syncUserVote:function(a){var b=new Firebase(g).child("userVotes").child(a),c=d(b);return c.$asArray()}}}]).factory("counterService",["$FirebaseObject","fbutil",function(a,b){var c=a.$extendFactory({plusSaved:function(){this.deleted=this.deleted||0,this.saved=this.saved||0,this.saved++,this.$save()},plusDeleted:function(){this.saved=this.saved||0,this.deleted=this.deleted||0,this.deleted++,this.$save()}});return{voteCounters:function(a){if(!a)throw new Error("voteId argument is not valid");return b.fb("counters/votes/"+a,{objectFactory:c}).$asObject()}}}]).factory("activityService",["$q","$log","$rootScope","fbutil","ACTIVITY_LIMIT",function(a,b,c,d,e){function f(a,b,c){function d(a,b){return a&&a.id&&a.displayName?{id:a.id,displayName:a.displayName||"Anonymous",pageUrl:b&&b.pageUrl?b.pageUrl:null,pictureUrl:b&&b.pictureUrl?b.pictureUrl:null}:null}var e=h.getMessage(a),f={displayName:b&&b.displayName?b.displayName:"Anonymous"};return{date:moment().utc().toISOString(),title:S(e.title).template(f).s,content:S(e.content).template(f).s,type:e.type,icon:e.icon,userInfo:d(b,c)}}function g(b){var c=d.ref("activities"),e=c.push(),f=+moment("2030-01-01T00:00:00")-+moment(),g=a.defer();return e.setWithPriority(b,f,function(a){a?g.reject(a):g.resolve(b)}),g.promise}var h={usersignedup:{title:"Nouvel arrivant!",content:"{{displayName}} vient de rejoindre notre petite communauté. Bienvenue à lui/elle !",type:"primary",icon:"child"},usersignedin:{title:"Connexion",content:"{{displayName}} s'est connecté.",type:"info",icon:"sign-in"},usersignedout:{title:"Déconnexion",content:"{{displayName}} s'est déconnecté.",type:"default",icon:"sign-out"},uservotesaved:{title:"A voté",content:"{{displayName}} a voté. Merci à lui.",type:"success",icon:"heart"},uservotedeleted:{title:"N'aime plus son vote",content:"{{displayName}} n'aimait pas son vote et l'a supprimé.",type:"danger",icon:"undo"},hasKey:function(a){return a?a.toLowerCase()in h:!1},getMessage:function(a){if(!a||!h.hasKey(a))throw new Error("unknown message : "+a);return h[a.toLowerCase()]}};return{publish:function(c,d,e){if(!h.hasKey(c)){var i=a.defer();return i.reject("unknown activity "+c),i.promise}var j=f(c,d,e);return b.debug("publishing activity",j),g(j)},exist:function(a){return h.hasKey(a)},sync:function(a){return d.syncArray("activities",{limit:a||e})},like:function(a,b,c){if(a){var e=d.ref("activities").child(a).child("likers").child(b.id);e.set({displayName:b.displayName,pictureUrl:c.pictureUrl})}}}}]).factory("voteService",["$log","$q","$FirebaseObject","$FirebaseArray","fbutil","ANONYMOUS_ID","counterService","activityService",function(c,d,e,f,g,h,i,j){function k(a,b,c){this.votes=a||[],this.voters=b||[],this.totalPoints=c||0}function l(b){if(!a.isObject(b))return new k;var d={},e=[],f={},g=[],h=0;a.forEach(b,function(b){if(a.isObject(b)&&a.isObject(b.voteItems)){var c=b.userInfo;a.forEach(b.voteItems,function(a){d[a.id]=d[a.id]||{id:a.id,value:a.value,points:0,num:0,voters:[]},d[a.id].points+=a.points,d[a.id].num+=1,h+=a.points,d[a.id].voters.push({displayName:c.displayName,pageUrl:c.pageUrl,pictureUrl:c.pictureUrl,points:a.points})}),f[c.id]=f[c.id]||c}}),c.debug("voteSummaryService:computeResult:allVotesMap",d),a.forEach(d,function(a){e.push(a)}),e.sort(function(a,b){var c=b.points-a.points;return 0!==c?c:b.voters.length-a.voters.length}),c.debug("voteSummaryService:computeResult:allVotersMap",f),a.forEach(f,function(a){g.push(a)});var i=new k(e,g,h);return c.debug("voteSummaryService:computeResult:summary",i),i}function m(b,c,d){if(!(b&&c&&d&&a.isArray(d)))throw new Error("Invalid arguments");d.sort(function(a,b){return b.points-a.points});var e={userInfo:{id:b.id||h,displayName:b.displayName||"Anonymous",pageUrl:c.pageUrl||null,pictureUrl:c.pictureUrl||null},date:+moment().utc(),voteItems:[]};return d.forEach(function(a){e.voteItems[a.id]=a}),e}function n(b,c,d){if(!(b&&c&&d&&a.isArray(d)))throw new Error("Invalid arguments");var e=[];a.forEach(d,function(b){e.push("function"==typeof b.toJSON?b.toJSON():a.copy(b))}),e.sort(function(a,b){return b.dateUtc.diff(a.dateUtc)});var f={userInfo:{id:b.id||h,displayName:b.displayName||"Anonymous",pageUrl:c.pageUrl||null,pictureUrl:c.pictureUrl||null},date:+moment().utc(),suggestionItems:e};return f}var o=e.$extendFactory({isEmpty:function(){if(!this.voteItems||!a.isObject(this.voteItems))return!0;for(var b in this.voteItems)if(this.voteItems.hasOwnProperty(b))return!1;return!0}});return{sync:{votes:g.syncArray("votes"),vote:function(a){if(!a)throw new Error("voteId argument is not valid");return g.syncObject("votes/"+a)},voteResult:function(a){if(!a)throw new Error("voteId argument is not valid");return g.syncArray("voteResults/"+a)},userVotes:g.syncArray("userVotes"),userVote:function(a,b){if(!a)throw new Error("userId argument is not valid");if(!b)throw new Error("voteId argument is not valid");return g.fb("userVotes/"+a+"/"+b,{objectFactory:o}).$asObject()},voteSummary:function(b){if(!b)throw new Error("voteId argument is not valid");var d=new k,f=e.$extendFactory({toJSON:function(){var b={};return a.forEach(this,function(a,c){var d=S(c.toString());d.startsWith("$")||d.startsWith("$$")||(b[c]=a)}),b}}),h=g.syncObject("voteResults/"+b,{objectFactory:f});return h.$watch(function(){c.debug("voteSummaryService:syncWatch",{voteId:b,args:arguments});var e=l(h.toJSON());d.votes.splice(0,d.votes.length),a.forEach(e.votes,function(a){d.votes.push(a)}),d.voters.splice(0,d.voters.length),a.forEach(e.voters,function(a){d.voters.push(a)}),d.totalPoints=e.totalPoints}),d}},saveVote:function(b,c,d,e){if(!b||!a.isObject(c))throw new Error("Invalid arguments",arguments);var f=g.fb("votes");return f.$set(b,c).then(function(){j.publish("voteadded",d,e)})},removeVote:function(a,b,c){if(!a)throw new Error("Invalid arguments",arguments);var d=g.fb("votes");return d.$remove(a).then(function(){j.publish("voteremoved",b,c)})},saveUserVote:function(b,c,e,f){if(!(b&&c&&a.isArray(c)&&e&&f))throw new Error("Invalid arguments",arguments);var h=g.fb("userVotes/"+e.id),k=g.fb("voteResults/"+b),l=i.voteCounters(b),n=m(e,f,c);return d.all([h.$set(b,n),k.$set(e.id,n)]).then(function(){l.plusSaved(),j.publish("uservotesaved",e,f)})},removeUserVote:function(a,b,c){if(!a||!b||!c)throw new Error("Invalid arguments",arguments);var e=g.fb("userVotes/"+b.id+"/"+a),f=g.fb("voteResults/"+a+"/"+b.id),h=i.voteCounters(a);return d.all([e.$remove(),f.$remove()]).then(function(){h.plusDeleted(),j.publish("uservotedeleted",b,c)})},createSelection:function(a,c){var d=new b(c);return d.voteId=a,d},isVoteOpened:function(b){if(!b||!a.isObject(b))return!1;var c=moment(),d=moment(b.dateStart?b.dateStart:0),e=moment(b.dateEnd?b.dateEnd:"2020-01-01");return c.isAfter(d,"min")&&c.isBefore(e,"min")},getVoteProgress:function(b){if(!a.isObject(b)||!b.dateEnd)return 0;var c=b.dateStart?moment(b.dateStart):moment(),d=moment(b.dateEnd?b.dateEnd:"2020-01-01"),e=moment(),f=d.diff(c),g=Math.round(100*d.diff(e)/f);return g>0?g:0},saveVoteSuggestion:function(b,c,e,f){if(!(b&&c&&a.isArray(c)&&e&&f))throw new Error("Invalid arguments",arguments);var h=g.fb("voteSuggestions/"+b),i=g.fb("userVoteSuggestions/"+e.id+"/"+b),k=n(e,f,c);return d.all([h.$push(k),i.$push(k)]).then(function(){j.publish("votesuggestionsave",e,f)})}}}]).factory("notifier",["$window",function(a){return a.toastr.options={closeButton:!1,debug:!1,positionClass:"toast-bottom-left",onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},{success:function(b,c){b&&a.toastr.success(b,c)},info:function(b,c){b&&a.toastr.info(b,c)},warning:function(b,c){b&&a.toastr.warning(b,c)},error:function(b,c){b&&a.toastr.error(b,c)}}}]).factory("nameCheckService",["$log","$q","$http",function(a,b,c){function d(a){this.id=a.key,this.name=a.name,this.query=a.query,this.dateUtc=a.dateUtc?moment(a.dateUtc):moment(),this.domains=a.domains||[],this.socialNetworks=a.socialNetworks||[]}return d.prototype={isValid:function(){return this.socialNetworks&&this.socialNetworks.twitter===!0&&this.domains&&this.domains.com&&this.domains.com===!0},getRate:function(){var a=0;return this.socialNetworks.twitter===!0&&(a+=30),this.domains.com===!0&&(a+=40),this.domains.net===!0&&(a+=15),this.domains.org===!0&&(a+=15),Math.round(a/20)},toJSON:function(){return{id:this.id,name:this.name,query:this.query,dateUtc:this.dateUtc.toISOString(),domains:this.domains,socialNetworks:this.socialNetworks}}},{check:function(a){var e=b.defer();return a||e.reject(),c.get("https://namecheck.azurewebsites.net/api/namechecks/"+a,{cache:!1,responseType:"json"}).success(function(a){e.resolve(new d(a))}).error(function(a,b){e.reject({data:a,status:b})}),e.promise}}}])}(window.angular||{}),function(a){"use strict";a.module("app.directives",["simpleLogin"]).directive("navToggler",["$rootScope",function(a){return{restrict:"A",link:function(b,c){var d=$("#app");return c.on("click",function(b){var c=!0;return d.hasClass("nav-collapsed-min")?(d.removeClass("nav-collapsed-min"),c=!1):(d.addClass("nav-collapsed-min"),c=!0),a.$broadcast("nav:stateChanged",{collapsed:c}),b.preventDefault()})}}}]).directive("reactiveLayout",function(){return{restrict:"A",controller:["$scope","$element","$location",function(a,b,c){var d,e;return e=function(){return c.path()},d=function(a){switch(b.removeClass("body-wide body-err body-auth"),a){case"/404":case"/500":return b.addClass("body-wide body-err");case"/signin":return b.addClass("body-wide body-auth")}},d(c.path()),a.$watch(e,function(a,b){return a!==b?d(c.path()):void 0})}]}}).directive("scrollTo",["$timeout",function(b){function c(b){return function(){var c=a.element(b.container),d="number"==typeof b.scrollTo?b.scrollTo:a.element(b.scrollTo),e="number"==typeof d?d:d.offset().top-b.offset;c.animate({scrollTop:e},b.duration,b.easing,function(a){"function"==typeof a&&a.call(this)})}}return{restrict:"A",link:function(d,e,f){var g=a.extend({container:"html, body",scrollTo:a.element(),offset:0,duration:150,easing:"swing"},f);e.on("click",function(){b(c(g))})}}}]).directive("toggleOffCanvas",function(){return{restrict:"A",link:function(a,b){b.on("click",function(){$("#app").toggleClass("on-canvas")})}}})}(window.angular||{}),function(a){"use strict";a.module("app.decorators",["firebase.utils","simpleLogin"]).config(["$provide",function(a){a.decorator("ngCloakDirective",["$delegate","simpleLogin",function(a,b){var c=a[0],d=c.compile;return c.compile=function(a,e){b.getUser().then(function(){d.call(c,a,e)})},a}])}])}(window.angular||{}),function(a){"use strict";a.module("app.filters",[]).filter("activeVotes",["voteService",function(b){function c(c){return c&&a.isObject(c)?c.isLocked===!0?!1:b.isVoteOpened(c):!1}return function(b){if(!a.isArray(b))return b;for(var d=[],e=0;e<b.length;e++){var f=b[e];c(f)&&d.push(f)}return d}}])}(window.angular||{}),function(a){"use strict";a.module("firebase.utils",["firebase","app.config"]).factory("fbutil",["$window","FBURL","$firebase",function(b,c,d){function e(b){for(var c=0;c<b.length;c++)if(a.isArray(b[c]))b[c]=e(b[c]);else if("string"!=typeof b[c])throw new Error("Argument "+c+" to firebaseRef is not a string: "+b[c]);return b.join("/")}function f(){var a=new b.Firebase(c),d=Array.prototype.slice.call(arguments);return d.length&&(a=a.child(e(d))),a}function g(b,c){var e=f(b);return c=a.extend({},c),a.forEach(["limit","startAt","endAt"],function(b){if(c.hasOwnProperty(b)){var d=c[b];e=e[b].apply(e,a.isArray(d)?d:[d]),delete c[b]}}),d(e,c)}return{syncObject:function(){return g.apply(null,arguments).$asObject()},syncArray:function(){return g.apply(null,arguments).$asArray()},ref:f,fb:function(a,b){return d(f(a),b)}}}])}(window.angular||{}),function(a){"use strict";a.module("simpleLogin",["firebase","firebase.utils"]).factory("requireUser",["simpleLogin","$q",function(a,b){return function(){return a.getUser().then(function(a){return a?a:b.reject({authRequired:!0})})}}]).factory("simpleLogin",["$firebaseSimpleLogin","fbutil","$q","$rootScope",function(b,c,d,e){function f(){i.getUser().then(function(b){i.user=b||null,a.forEach(h,function(a){a(b||null)})})}var g=b(c.ref()),h=[],i={user:null,getUser:function(){return g.$getCurrentUser()},login:function(a){switch(a){case"facebook":return g.$login("facebook",{preferRedirect:!0,rememberMe:!0,scope:"public_profile"});case"google":return g.$login("google",{preferRedirect:!0,rememberMe:!0,scope:"profile, email"});default:throw new Error("Login provider not supported")}},logout:function(){g.$logout()},watch:function(a,b){i.getUser().then(function(b){a(b)}),h.push(a);var c=function(){var b=h.indexOf(a);b>-1&&h.splice(b,1)};return b&&b.$on("$destroy",c),c}};return e.$on("$firebaseSimpleLogin:login",f),e.$on("$firebaseSimpleLogin:logout",f),e.$on("$firebaseSimpleLogin:error",f),f(),i}])}(window.angular||{});